/*!
 * artDialog v6.0.0 
 * Date: 2013-12-25
 * https://github.com/aui/artDialog
 * (c) 2009-2013 TangBin, http://www.planeArt.cn
 *
 * This is licensed under the GNU LGPL, version 2.1 or later.
 * For details, see: http://www.gnu.org/licenses/lgpl-2.1.html
 */

define(["require","jquery","dialogPopup","dialogConfig","constUtil"],function(e){var t=e("jquery"),n=e("dialogPopup"),r=e("dialogConfig"),i=e("constUtil"),s=r.cssUri;s&&(s=e[e.toUrl?"toUrl":"resolve"](s),s='<link rel="stylesheet" href="'+i.domain+s+'" />',t("base")[0]?t("base").before(s):t("head").append(s));var o="6.0.0",u=0,a=new Date-0,f=!("minWidth"in t("html")[0].style),l="createTouch"in document&&!("onmousemove"in document)||/(iPhone|iPad|iPod)/i.test(navigator.userAgent),c=!f&&!l,h=function(e,n,r){var i=e=e||{};if(typeof e=="string"||e.nodeType===1)e={content:e,fixed:!l};e=t.extend(!0,{},h.defaults,e),e._=i;var s=e.id=e.id||a+u,o=h.get(s);return o?o.focus():(c||(e.fixed=!1),e.quickClose&&(e.modal=!0,i.backdropOpacity||(e.backdropOpacity=0)),t.isArray(e.button)||(e.button=[]),r!==undefined&&(e.cancel=r),e.cancel&&e.button.push({id:"cancel",value:e.cancelValue,callback:e.cancel}),n!==undefined&&(e.ok=n),e.ok&&e.button.push({id:"ok",value:e.okValue,callback:e.ok,autofocus:!0}),h.list[s]=new h.create(e))},p=function(){};p.prototype=n.prototype;var d=h.prototype=new p;return h.version=o,h.create=function(e){var r=this;t.extend(this,new n);var i=t(this.node).html(e.innerHTML);return this.options=e,this._popup=i,t.each(e,function(e,t){typeof r[e]=="function"?r[e](t):r[e]=t}),e.zIndex&&(n.zIndex=e.zIndex),i.attr({"aria-labelledby":this._$("title").attr("id","title:"+this.id).attr("id"),"aria-describedby":this._$("content").attr("id","content:"+this.id).attr("id")}),this._$("close").css("display",this.cancel===!1?"none":"").attr("title",this.cancelValue).on("click",function(e){r._trigger("cancel"),e.preventDefault()}),this._$("dialog").addClass(this.skin),this._$("body").css("padding",this.padding),i.on("click","[data-id]",function(e){var n=t(this);n.attr("disabled")||r._trigger(n.data("id")),e.preventDefault()}),e.quickClose&&t(this.backdrop).on("onmousedown"in document?"mousedown":"click",function(){r._trigger("cancel")}),this._esc=function(e){var t=e.target,i=t.nodeName,s=/^input|textarea$/i,o=n.current===r,u=e.keyCode;if(!o||s.test(i)&&t.type!=="button")return;u===27&&r._trigger("cancel")},t(document).on("keydown",this._esc),this.addEventListener("remove",function(){t(document).off("keydown",this._esc),delete h.list[this.id]}),u++,h.oncreate(this),this},h.create.prototype=d,t.extend(d,{content:function(e){return this._$("content").empty("")[typeof e=="object"?"append":"html"](e),this.reset()},title:function(e){return this._$("title").text(e),this._$("header")[e?"show":"hide"](),this},width:function(e){return this._$("content").css("width",e),this.reset()},height:function(e){return this._$("content").css("height",e),this.reset()},button:function(e){e=e||[];var n=this,r="";return this.callbacks={},this._$("footer")[e.length?"show":"hide"](),typeof e=="string"?r=e:t.each(e,function(e,t){t.id=t.id||t.value,n.callbacks[t.id]=t.callback,r+='<button type="button" data-id="'+t.id+'"'+(t.disabled?" disabled":"")+(t.autofocus?' autofocus class="ui-dialog-autofocus"':"")+">"+t.value+"</button>"}),this._$("button").html(r),this},statusbar:function(e){return this._$("statusbar").html(e)[e?"show":"hide"](),this},_$:function(e){return this._popup.find("[i="+e+"]")},_trigger:function(e){var t=this.callbacks[e];return typeof t!="function"||t.call(this)!==!1?this.close().remove():this}}),h.oncreate=t.noop,h.getCurrent=function(){return n.current},h.get=function(e){return e===undefined?h.list:h.list[e]},h.list={},h.defaults=r,h});